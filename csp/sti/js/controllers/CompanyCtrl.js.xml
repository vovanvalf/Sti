<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="25">
<CSP name="sti/js/controllers/CompanyCtrl.js" application="/csp/sti/" default="1"><![CDATA[
'use strict';


/*===========================================================================================
Компания. Изменение/Добавление
===========================================================================================*/

controllersModule.controller('CompanyCtrl', function($scope, $routeParams, CompanySrvc, $window, $filter, UtilsSrvc){
   $scope.page = {company:{}};

   // Инициализация данных
   $scope.page.init = function(){
      if ($routeParams.id){
          $scope.page.formCaption = $filter('localize')("Редактирование компании");
          $scope.page.formBtnSubmitName = $filter('localize')("Сохранить");
          $scope.page.loadCompany($routeParams.id);        
      }
      else{
          $scope.page.formCaption = $filter('localize')("Добавление компании");
          $scope.page.formBtnSubmitName = $filter('localize')("Добавить");


      }
   };
   // Загрузить компанию по ИД
   $scope.page.loadCompany = function(id){
      CompanySrvc.get(id).then(
          function(data){
              $scope.page.company = data;
         
          },
          function(data, status, headers, config){
              $scope.page.coalert = UtilsSrvc.getAlert('Внимание!', data, 'error', true);
          });       
   };
   // Сохранить/создать (отправка формы). Передаем объект на сервер
   $scope.page.submit = function(){
      CompanySrvc.save($scope.page.company).then(
          function(data){
              var msg = 'Изменения сохранены.';

              if (!$routeParams.id){
                  msg = 'Компания добавлена.';
                  $scope.page.company = {};                        
              }

              $scope.page.alert = UtilsSrvc.getAlert('Готово!', msg, 'success', true);
              // Сделать форму "чистой" (блокируется кнопка)
              $scope.pageForm.$setPristine();
          },
          function(data, status, headers, config){
              $scope.page.alert = UtilsSrvc.getAlert('Внимание!', data, 'error', true); 
          });
   };
	
	 /// Отмена - возврат на предыдущую страницу
    $scope.page.cancel = function(){
        $window.history.back();
    };
    
    
   $scope.page.init(); 
});


]]></CSP>
</Export>
