<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="25">
<CSP name="sti/js/controllers/AllInternCtrl.js" application="/csp/sti/" default="1"><![CDATA[
'use strict';
/*===========================================================================================
Все стажеры
===========================================================================================*/

controllersModule.controller('AllInternCtrl', function($scope, $location, InternSrvc){
   $scope.page = {};

   // Инициализация данных
   $scope.page.init = function(){
     /* Данные для таблицы со стажерами, объект будет передан в компонент dmgrid
        Заголовок таблицы. 
        Сss класс для таблицы. 
        Имена колонок и имя свойства для доступа к значению.
        Методы для работы с данными */
        $scope.page.grid = {
            caption: 'Стажеры',
            cssClass: 'table table-bordered table-hover',
            columns: [{name: 'Фамилия', property: 'lastname'}, 
                      {name: 'Имя', property: 'firstname'},
                      {name: 'Отчество', property: 'middlename'},
                      {name: 'Дата рождения', property: ''},
                      {name: 'Университет', property: 'university.fullName'},/*Сделать как-нибудь ссылку*/
                      {name: 'Город', property: 'city.name'},
					   /* EngName
                         EngSurName - эти свойства есть в ТЗ. Если будет мультиязычность - нет необходимости(уточнить у заказчика)
                       */
                      ],
            add: $scope.page.addIntern,
            edit: $scope.page.editIntern,
            remove: $scope.page.removeIntern
        };

        $scope.page.loadInterns();
   };

   // Загрузить всех стажеров
   $scope.page.loadInterns = function(){
        InternSrvc.getAll().then(
            function(data){
                $scope.page.grid.items = data.children;
            },
            function(data, status, headers, config){
                $scope.page.gralert = {title: 'Внимание!', msg: 'Стажеры не загружены. ' + data, cssClass: 'alert alert-error', visible: true};  
            });      
   };

   // Перейти на др. страницу для добавления стажера
   $scope.page.addIntern = function(){
        $location.path('/intern/');
   };

   // Перейти на др. страницу для редактирования стажера по ИД
   $scope.page.editIntern = function(intern){
        $location.path('/intern/' + intern.id);
   };

   // Удалить стажера по ИД
   $scope.page.removeIntern = function(intern){
        InternSrvc.remove(intern.id).then(
            function(data){
              	$scope.page.alert = {title: 'Готово!', msg: 'Стажер удален.', cssClass: 'alert alert-success', visible: true, closeTimeout: 1500};
            	  $scope.page.loadInterns();
            	  $scope.page.grid.selected = null;
            },
            function(data, status, headers, config){
                $scope.page.alert = {title: 'Внимание!', msg: data, cssClass: 'alert alert-error', visible: true};  
            });
   };

   $scope.page.init(); 
});

]]></CSP>
</Export>
