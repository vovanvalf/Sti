<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="25">
<CSP name="sti/js/controllers/AllUniversityCtrl.js" application="/csp/sti/" default="1"><![CDATA[
'use strict';
//ddd

/*===========================================================================================
Все университеты
===========================================================================================*/

controllersModule.controller('AllUniversityCtrl', function($scope, $location, UniversitySrvc, InternSrvc){
    $scope.page = {};

    // Инициализация данных
    $scope.page.init = function(){
        /* Данные для таблицы с универами, объект будет передан в компонент dmgrid
           Заголовок таблицы. 
           Сss класс для таблицы. 
           Имена колонок и имя свойства для доступа к значению.
           Методы для работы с данными */
        $scope.page.ungrid = {
            caption: 'Университеты',
            cssClass: 'table table-bordered table-hover',
            columns: [{name: 'Университет', property: 'fullName'},
            		  {name: 'Страна', property: 'city.parentName'},
            		  {name: 'Город', property: 'city.name'}],
            add: $scope.page.addUniversity,
            edit: $scope.page.editUniversity,
            remove: $scope.page.removeUniversity
        };
        // Загрузить все университеты из БД
        $scope.page.loadUniversities();
   };
  

    // Загрузить все университеты из БД
    $scope.page.loadUniversities = function(){
        UniversitySrvc.getAll().then(
            function(data){
                // Успех. Передать данные в грид
                $scope.page.ungrid.items = data.children;
            },
            function(data, status, headers, config){
                // Ошибка
                $scope.page.unalert = {title: 'Внимание!', msg: 'Университеты не загружены. ' + data, cssClass: 'alert alert-error', visible: true};  
            });      
    };

    // Загрузить стажеров университетов
    $scope.page.loadUniversityInterns = function(university){
        UniversitySrvc.getInterns(university.id).then(
            function(data){
                university.interns = data.children;
            },
            function(data, status, headers, config){
                $scope.page.unalert = {title: 'Внимание!', msg: 'Университеты не загружены. ' + data, cssClass: 'alert alert-error', visible: true};  
            });       
    };

    // Добавить универ. Переход на другую страницу
    $scope.page.addUniversity = function(){
        $location.path('/university/');
    };

    // Редактировать универ. Переход на другую страницу
    $scope.page.editUniversity = function(university){
        $location.path('/university/' + university.id);
    };

    // Удалить универ
    $scope.page.removeUniversity = function(university){
        UniversitySrvc.remove(university.id).then(
            function(data){
                $scope.page.gralert = {title: 'Готово!', msg: 'Университет удален.', cssClass: 'alert alert-success', visible: true, closeTimeout: 1500};
                $scope.page.loadUniversities();
                $scope.page.ungrid.selected = null;
            },
            function(data, status, headers, config){
                $scope.page.gralert = {title: 'Внимание!', msg: data, cssClass: 'alert alert-error', visible: true};  
            });
    };
    $scope.page.init(); 
});

]]></CSP>
</Export>
